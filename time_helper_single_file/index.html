<!DOCTYPE html>
<html lang="en">

<head>
    <!--
        Tailwind CSS is a utility-first CSS framework that provides low-level utility classes 
        for building custom designs directly in your HTML. Instead of writing custom CSS, 
        you compose your UI by combining Tailwind's utility classes for layout, spacing, 
        typography, colors, and more. This approach enables rapid development, consistent 
        styling, and easy maintenance of responsive and modern web interfaces.
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time helper</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <!-- <link rel="stylesheet" href="style.css"> -->
    <style>
        :root {
            --primary-black: #1f2937;
            --primary-white: #f3f4f6;
            --ring-size: 200px;
        }

        body {
            font-family: 'Inter', sans-serif;
        }

        /* .cronometer-svg {
            Remove rotation to make progress clockwise
            transform: rotate(-90deg);
        } */

        .timer-bg {
            stroke: var(--primary-white);
            stroke-width: 12;
            fill: none;
        }

        #timer-progress {
            stroke: var(--primary-black);
            stroke-width: 12;
            fill: none;
            transition: stroke-dashoffset 0.1s linear;
        }

        .center-time {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-black);
            pointer-events: none;
        }

        .label-selected {
            /* gray-700 */
            color: #fff !important;
            font-weight: 600;
            box-shadow: 0 0 0 2px #4b5563;
            border-radius: 0.5rem;
            transition: background 0.2s, color 0.2s;
        }

        .time-selected {
            background-color: #8aa8d3 !important;
        }

        .pause-selected {
            background-color: #d38a8a !important;
        }

        .pause-separator {
            border: #606060 solid 1px;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">

    <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg md:p-8 relative" style="width: fit-content;">

        <!-- Menu button -->
        <div class="absolute top-4 right-4 z-50">
            <button id="menu-btn" class="p-2 rounded-lg bg-gray-200 hover:bg-gray-300 shadow-lg">
                <svg id="menu-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" width="28" height="28">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16M4 12h16" />
                </svg>
            </button>

            <!-- Menu panel -->
            <div id="menu-panel"
                class="hidden absolute right-0 mt-2 w-72 bg-white rounded-xl shadow-xl border border-gray-200 p-4 space-y-4">

                <div class="flex space-x-4">
                    <button id="message-btn"
                        class="w-3/4 py-3 px-3 bg-red-200 hover:bg-red-300 text-black font-semibold rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-[1.01] focus:outline-none text-sm md:text-base">
                        <!-- label updated by JS -->
                    </button>
                    <button id="sound-btn"
                        class="w-1/4 py-3 px-3 bg-red-200 hover:bg-red-300 rounded-full shadow-md transition duration-150 ease-in-out focus:outline-none text-sm md:text-base">
                        <svg id="sound-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor" width="24" height="24"></svg>
                    </button>
                </div>

                <div>
                    <label for="volume-slider" class="block text-gray-700 font-semibold mb-2">Volume</label>
                    <input id="volume-slider" type="range" min="0" max="1" step="0.01" value="0.5" class="w-full">
                </div>

                <!-- time options -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Time options (min)</label>
                    <div id="custom-times-grid" class="grid grid-cols-3 gap-2 mb-2">
                        <input type="text" maxlength="2"
                            class="custom-time-input p-2 border bg-gray-200 rounded-lg text-center" />
                        <input type="text" maxlength="2"
                            class="custom-time-input p-2 border bg-gray-200 rounded-lg text-center" />
                        <input type="text" maxlength="2"
                            class="custom-time-input p-2 border bg-gray-200 rounded-lg text-center" />
                        <input type="text" maxlength="2"
                            class="custom-time-input p-2 border bg-gray-200 rounded-lg text-center" />
                        <input type="text" maxlength="2"
                            class="custom-time-input p-2 border bg-gray-200 rounded-lg text-center" />
                        <input type="text" maxlength="2"
                            class="custom-time-input p-2 border bg-gray-200 rounded-lg text-center" />
                    </div>
                </div>

                <!-- pause options + two custom pause inputs -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Pause options (sec)</label>
                    <div id="custom-pauses-grid" class="grid grid-cols-2 gap-2 mb-2">
                        <input type="text" maxlength="4" placeholder="Custom sec #1"
                            class="custom-pause-input p-2 border bg-gray-200 rounded-lg text-center" />
                        <input type="text" maxlength="4" placeholder="Custom sec #2"
                            class="custom-pause-input p-2 border bg-gray-200 rounded-lg text-center" />
                    </div>
                    <div class="text-xs text-gray-500 mb-2">Enter custom pause durations in seconds (optional).</div>
                </div>

                <div>
                    <button id="about-btn" class="max-w-full text-center text-sm text-gray-600"
                        style="width: -webkit-fill-available;">About</button>
                </div>

            </div>
        </div>

        <!-- App panel -->
        <div class="md:flex md:space-x-8 items-center justify-center w-full mt-4">

            <div class="flex-shrink-0 relative flex items-center justify-center mb-8 md:mb-0"
                style="height: var(--ring-size);">
                <svg class="cronometer-svg" width="100%" height="100%" viewBox="0 0 200 200">
                    <circle class="timer-bg" cx="100" cy="100" r="90"></circle>
                    <circle id="timer-progress" cx="100" cy="100" r="90" transform="rotate(-90 100 100)"></circle>
                </svg>
                <div id="time-display" class="center-time">01:00</div>
            </div>

            <div class="flex-grow w-full max-w-xs mx-auto md:mx-0">
                <div id="time-options" class="grid grid-cols-3 gap-3 mb-3 mt-12"></div>
                <hr class="pause-separator">
                <div id="pause-options" class="grid grid-cols-2 gap-3 mb-6 mt-3"></div>
                <div class="flex space-x-4">
                    <button id="start-btn"
                        class="flex-1 py-3 px-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-green-500/50 text-sm md:text-base">Start</button>
                    <button id="reset-btn"
                        class="flex-1 py-3 px-3 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-lg shadow-md transition duration-150 ease-in-out focus:outline-none focus:ring-4 focus:ring-blue-500/50 text-sm md:text-base">Reset</button>
                </div>
                <div id="message-box"
                    class="mt-4 p-3 bg-blue-100 border border-blue-300 text-blue-700 rounded-lg hidden text-sm"></div>
            </div>

        </div>
    </div>

    <!-- About modal -->
    <div id="about-modal" class="hidden fixed inset-0 bg-black-40 flex items-center justify-center"
        style="z-index: 51;">

        <div class="flex flex-col items-center">
            <div id="about-content" class="bg-white p-6 rounded-lg max-w-sm">
                <h3 class="text-lg font-semibold mt-4">App</h3>
                <p class="mt-2 text-sm">Time Helper is a minimalist application (ES6 + Tailwind CSS) to manage short
                    time
                    intervals.</p>
                <p class="mt-2 text-sm">Use cases:</p>
                <ul class="list-disc list-outside pl-4 text-sm mt-2">
                    <li class="mt-2 text-sm">Manage home <strong>workout</strong> intervals</li>
                    <li class="mt-2 text-sm">Monitor strategy-game <strong>cooldowns</strong> (e.g. SimCity BuildIt)
                    </li>
                </ul>
                <p class="mt-2 text-sm">Lightweight, configurable and focused on distraction-free timing.</p>

                <div class="mt-4 pt-3 border-t border-gray-200 text-sm">
                    <h3 class="text-lg font-semibold mt-4">Author</h3>
                    <p class="mt-2 text-sm">Cícero Lima — practical solutions combining personal interests with
                        technical
                        skills.</p>
                    <p class="mt-2 text-gray-600">October 17, 2025</p>
                </div>
            </div>
            <button id="close-about-modal-btn"
                class="mt-4 w-10 h-10 border-black bg-white text-gray-800 rounded-full shadow-lg flex items-center justify-center 
                   hover:bg-gray-200 focus:outline-none focus:ring-4 focus:ring-gray-300 transition duration-150 ease-in-out">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>

        </div>
    </div>

    <!-- <script src="main.js"></script> -->
    <!-- <script src="about.js"></script> -->
    <script>
        /* - - - - - - - - - - [log wrapper for debug] - - - - - - - - - - */
        const DEBUG = true; // toggle for debug decorator
        const cdebug = (...args) => { if (DEBUG) console.debug(...args); };
        const cerror = (...args) => { if (DEBUG) console.error(...args); };
        const log = (fn, name = fn.name || 'anonymous') => {
                return (...args) => {
                    const start = DEBUG ? performance.now() : null;
                    // cdebug(`[${name}] →`, ...args);
                    try {
                        const result = fn(...args) || 'null';
                        cdebug(`[${name}] \t(`,...args,`) => `, result, `(${(performance.now() - start).toFixed(2)}ms)`);
                        return result;
                    } catch (err) {
                        cerror(`[${name}] ✖`, err);
                        throw err;
                    }
                };
            };
        /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

        // Core configuration
        const TIME_OPTIONS = [1, 3, 5, 10, 15, 30];
        const PAUSE_OPTIONS = [30, 60]; // seconds - will be extended by custom pause inputs
        const CIRCLE_RADIUS = 90;
        const CIRCUMFERENCE = 2 * Math.PI * CIRCLE_RADIUS;

        // Elements
        const timeDisplay = document.getElementById('time-display');
        const timerProgress = document.getElementById('timer-progress');
        const timeOptionsContainer = document.getElementById('time-options');
        const pauseOptionsContainer = document.getElementById('pause-options');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');
        const messageBox = document.getElementById('message-box');

        // State
        let totalTimeSeconds = TIME_OPTIONS[0] * 60;
        let pauseTimeSeconds = 0; // 0 = no pause
        let timeLeftSeconds = totalTimeSeconds;
        let isRunning = false;
        let isPaused = false; // true when currently in a pause interval
        let timerInterval = null;
        let volume = 0.5;
        let soundEnabled = false;
        let messageEnabled = true;
        let messageTimeoutId = null;

        const menuBtn = document.getElementById('menu-btn');
        const menuPanel = document.getElementById('menu-panel');
        const messageBtn = document.getElementById('message-btn');
        const soundBtn = document.getElementById('sound-btn');
        const soundIcon = document.getElementById('sound-icon');
        const volumeSlider = document.getElementById('volume-slider');
        const customTimesGrid = document.getElementById('custom-times-grid');
        const customTimeInputs = customTimesGrid.querySelectorAll('.custom-time-input');
        const customPauseInputs = document.querySelectorAll('.custom-pause-input');

        timerProgress.style.strokeDasharray = CIRCUMFERENCE;
        timerProgress.style.strokeDashoffset = 0;

        const formatTime = (seconds) => {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            const pad = (n) => String(n).padStart(2, '0');
            return `${pad(minutes)}:${pad(remainingSeconds)}`;
        };

        const updateProgress = () => {
            const periodTotal = isPaused ? (pauseTimeSeconds || 1) : totalTimeSeconds;
            const percentage = timeLeftSeconds / periodTotal;
            const offset = CIRCUMFERENCE * (1 - percentage);
            timerProgress.style.strokeDashoffset = offset;
        };

        const updateDisplay = () => {
            timeDisplay.textContent = formatTime(timeLeftSeconds);
            updateProgress();
            timerProgress.style.stroke = isPaused ? '#dc2626' : 'var(--primary-black)';
        };

        const showMessage = log((text, type = 'blue', hold = false) => {
            if (!messageEnabled) return;

            // cancel previous pending override so "hold" actually keeps the message
            if (messageTimeoutId) {
                clearTimeout(messageTimeoutId);
                messageTimeoutId = null;
            }

            const setTextContent = (text, color) => {
                const COLORS = ['blue', 'green', 'red', 'gray']
                if (!COLORS.includes(color)) throw new Error(`invalid color ${color}`);

                messageBox.textContent = text;
                messageBox.className = `mt-4 p-3 border rounded-lg text-sm`;
                messageBox.classList.add(`bg-${color}-100`, `border-${color}-300`, `text-${color}-700`);
            };
            setTextContent(text, type);

            if (!hold) {
                messageTimeoutId = setTimeout(() => {
                    messageTimeoutId = null;
                    setTextContent(isRunning ? 'Timer running.' : 'Ready.', 'gray');
                }, 3000);
            }
        }, 'showMessage');

        const beep = log(() => {
            if (!soundEnabled) return;
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = ctx.createOscillator();
            const gain = ctx.createGain();
            oscillator.type = 'sine';
            oscillator.frequency.value = 880;
            gain.gain.value = volume;
            oscillator.connect(gain);
            gain.connect(ctx.destination);
            oscillator.start();
            setTimeout(() => { oscillator.stop(); ctx.close(); }, 200);
        }, 'beep');

        // Main loop: infinite cycle work->(pause)->work... until stopped
        const startLoop = log(() => {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (!isRunning) return;
                timeLeftSeconds--;
                updateDisplay();

                if (timeLeftSeconds <= 0) {
                    // period finished
                    beep();
                    if (isPaused) {
                        // pause finished -> resume work
                        isPaused = false;
                        timeLeftSeconds = totalTimeSeconds;
                        showMessage('Resuming work cycle.', 'blue');
                    } else {
                        // work finished -> either start pause or restart work immediately
                        if (pauseTimeSeconds > 0) {
                            isPaused = true;
                            timeLeftSeconds = pauseTimeSeconds;
                            showMessage(`Pause for ${pauseTimeSeconds} sec.`, 'red', true);
                        } else {
                            timeLeftSeconds = totalTimeSeconds;
                            showMessage('Restarting work cycle.', 'green');
                        }
                    }
                    updateDisplay();
                }
            }, 1000);
        }, 'startLoop');

        const handleStartStop = log(() => {
            if (isRunning) {
                // stop cycle
                clearInterval(timerInterval);
                timerInterval = null;
                isRunning = false;
                startBtn.textContent = 'Start';
                startBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
                startBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                showMessage('Timer stopped.', 'blue');
            } else {
                // start (resume) cycle
                isRunning = true;
                startBtn.textContent = 'Stop';
                startBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                startBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                // if timeLeftSeconds is zero, initialize depending on isPaused
                if (timeLeftSeconds <= 0) {
                    timeLeftSeconds = isPaused && pauseTimeSeconds > 0 ? pauseTimeSeconds : totalTimeSeconds;
                }
                startLoop();
                showMessage('Timer started.', 'green');
            }
        }, 'handleStartStop');

        const handleReset = log(() => {
            clearInterval(timerInterval);
            timerInterval = null;
            isRunning = false;
            isPaused = false;
            // restore selected time preset
            const selectedRadio = document.querySelector('input[name="time-preset"]:checked');
            const minutes = selectedRadio ? parseInt(selectedRadio.value) : TIME_OPTIONS[0];
            totalTimeSeconds = minutes * 60;
            // restore selected pause preset (0 = no pause)
            const selectedPause = document.querySelector('input[name="pause-preset"]:checked');
            pauseTimeSeconds = selectedPause ? parseInt(selectedPause.value) : 0;
            timeLeftSeconds = totalTimeSeconds;
            updateDisplay();
            startBtn.textContent = 'Start';
            startBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
            startBtn.classList.add('bg-green-600', 'hover:bg-green-700');
            showMessage('Timer reset to ' + formatTime(totalTimeSeconds) + '.', 'blue');
        }, 'handleReset');

        const createRadioOptions = log(() => {
            timeOptionsContainer.innerHTML = '';
            pauseOptionsContainer.innerHTML = '';

            const classes = "flex items-center justify-center p-2 rounded-lg cursor-pointer transition duration-150 ease-in-out shadow-inner bg-gray-50 hover:bg-gray-200 text-sm font-medium text-gray-700";

            // time presets
            TIME_OPTIONS.forEach((minutes, index) => {
                const isChecked = index === 0;
                const label = document.createElement('label');
                label.className = classes;
                if (isChecked) label.classList.add('label-selected', 'time-selected');
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = 'time-preset';
                input.value = minutes;
                input.className = 'hidden';
                input.checked = isChecked;
                const span = document.createElement('span');
                span.textContent = `${minutes} min`;
                input.addEventListener('change', handleTimeChange);
                label.appendChild(input);
                label.appendChild(span);
                timeOptionsContainer.appendChild(label);
            });

            // predefined + custom pause options
            PAUSE_OPTIONS.forEach((seconds) => {
                const label = document.createElement('label');
                label.className = classes;
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = 'pause-preset';
                input.value = seconds;
                input.className = 'hidden';
                input.checked = false;
                const span = document.createElement('span');
                span.textContent = `${seconds} sec`;
                input.addEventListener('click', handlePauseChange);
                label.appendChild(input);
                label.appendChild(span);
                pauseOptionsContainer.appendChild(label);
            });
        }, 'createRadioOptions');

        const handleTimeChange = log((event) => {
            // console.log('handleTimeChanges target: ', event.target)
            if (isRunning) {
                showMessage('Stop before make changes.', 'blue');
                return;
                /*
                // restore labels
                document.querySelectorAll('#time-options label').forEach(l =>
                    l.classList.remove('label-selected', 'time-selected')
                );
                const checked = document.querySelector('input[name="time-preset"]:checked');
                if (checked) checked.parentElement.classList.add('label-selected', 'time-selected');
                */
            }
            const newMinutes = parseInt(event.target.value);
            totalTimeSeconds = newMinutes * 60;
            timeLeftSeconds = totalTimeSeconds;
            updateDisplay();
            document.querySelectorAll('#time-options label').forEach(l =>
                l.classList.remove('label-selected', 'time-selected')
            );
            event.target.parentElement.classList.add('label-selected', 'time-selected');
        }, 'handleTimeChange');

        const handlePauseChange = log((event) => {
            // console.log('handlePauseChanges target: ', event.target.value)
            if (isRunning) {
                showMessage('Stop before make changes.', 'blue');
                return;
            }

            const label = event.target.parentElement;
            const isCurrentlyChecked = event.target.checked;

            // If clicking an already-selected radio, uncheck it
            if (isCurrentlyChecked && label.classList.contains('pause-selected')) {
                event.target.checked = false;
                pauseTimeSeconds = 0;
            } else {
                pauseTimeSeconds = parseInt(event.target.value);
            }

            // Update visual state
            document.querySelectorAll('#pause-options label').forEach(l =>
                l.classList.remove('label-selected', 'pause-selected')
            );

            const checked = document.querySelector('input[name="pause-preset"]:checked');
            if (checked) {
                checked.parentElement.classList.add('label-selected', 'pause-selected');
            }
        }, 'handlePauseChange');

        // Save custom time presets
        function saveCustomTimes() {
            const values = Array.from(customTimeInputs)
                .map(i => i.value.trim())
                .filter(v => v !== '')
                .map(v => parseInt(v, 10))
                .filter(v => !isNaN(v) && v > 0);

            if (values.length === 0 || values.length > 6) {
                showMessage('Please enter up to 6 positive numbers.', 'blue');
                return;
            }
            TIME_OPTIONS.length = 0;
            values.forEach(v => TIME_OPTIONS.push(v));
            localStorage.setItem('customTimes', values.join(','));
            handleReset();
            createRadioOptions();
        }

        // Save custom pauses (up to 2 inputs)
        function saveCustomPauses() {
            const values = Array.from(customPauseInputs)
                .map(i => i.value.trim())
                .filter(v => v !== '')
                .map(v => parseInt(v, 10))
                .filter(v => !isNaN(v) && v > 0);
            // rebuild PAUSE_OPTIONS from defaults + customs
            const defaults = [30, 60];
            PAUSE_OPTIONS = defaults.concat(values);
            localStorage.setItem('customPauses', values.join(','));
            handleReset();
            createRadioOptions();
        }

        // UI wiring
        menuBtn.addEventListener('click', () => menuPanel.classList.toggle('hidden'));
        document.addEventListener('mousedown', (e) => {
            if (!menuBtn.contains(e.target) && !menuPanel.contains(e.target)) menuPanel.classList.add('hidden');
        });

        const setSoundInterface = log(() => {
            soundIcon.innerHTML = soundEnabled
                ? `<path d="M9 9v6h4l5 5V4l-5 5H9z" />`
                : `<path d="M9 9v6h4l5 5V4l-5 5H9z"/><line x1="20" y1="4" x2="4" y2="20" stroke="red" stroke-width="2"/>`;
        }, 'setSoundInterface');

        // const saudacao = log((nome) => `Olá, ${nome}`, 'saudacao');
        const setMessageInterface = log(() => {
            if (messageEnabled) {
                messageBtn.classList.remove('bg-red-200', 'hover:bg-red-300');
                messageBtn.classList.add('bg-blue-200', 'hover:bg-blue-300');
                messageBox.classList.remove('hidden');
                messageBtn.innerHTML = `<span>Messages</span>`;
            } else {
                messageBtn.classList.add('bg-red-200', 'hover:bg-red-300');
                messageBtn.classList.remove('bg-blue-200', 'hover:bg-blue-300');
                messageBox.classList.add('hidden');
                messageBtn.innerHTML = `<span>Messages</span><span id="messages-line" class="absolute top-1/2 left-1/2 w-1/4 h-1 bg-red-500 transform -rotate-45 origin-center -translate-y-1/2 -translate-x-1/2"></span>`;
            }
        }, 'setMessageInterface');

        soundBtn.addEventListener('click', () => {
            soundEnabled = !soundEnabled;
            localStorage.setItem('soundEnabled', soundEnabled ? '1' : '0');
            setSoundInterface();
            if (soundEnabled) {
                soundBtn.classList.remove('bg-red-200', 'hover:bg-red-300');
                soundBtn.classList.add('bg-blue-200', 'hover:bg-blue-300');
            } else {
                soundBtn.classList.add('bg-red-200', 'hover:bg-red-300');
                soundBtn.classList.remove('bg-blue-200', 'hover:bg-blue-300');
            }
        });

        messageBtn.addEventListener('click', () => {
            messageEnabled = !messageEnabled;
            localStorage.setItem('messageEnabled', messageEnabled ? '1' : '0');
            setMessageInterface();
        });

        volumeSlider.addEventListener('input', (e) => {
            volume = parseFloat(e.target.value);
            localStorage.setItem('volume', volume);
        });

        customTimeInputs.forEach(input => {
            input.addEventListener('input', (e) => e.target.value = e.target.value.replace(/[^0-9]/g, ''));
            input.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.target.blur(); menuPanel.classList.add('hidden'); } });
            input.addEventListener('blur', saveCustomTimes);
        });

        customPauseInputs.forEach(input => {
            input.addEventListener('input', (e) => e.target.value = e.target.value.replace(/[^0-9]/g, ''));
            input.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.target.blur(); menuPanel.classList.add('hidden'); } });
            input.addEventListener('blur', saveCustomPauses);
        });

        startBtn.addEventListener('click', handleStartStop);
        resetBtn.addEventListener('click', handleReset);

        const aboutBtn = document.getElementById('about-btn');
        const aboutModal = document.getElementById('about-modal');
        const aboutContent = document.getElementById('about-content');

        aboutBtn.addEventListener('click', () => {
            aboutModal.classList.remove('hidden');
            menuPanel.classList.add('hidden');
        });

        aboutModal.addEventListener('mousedown', (e) => {
            if (!aboutContent.contains(e.target)) aboutModal.classList.add('hidden');
        });

        document.getElementById('close-about-modal-btn').addEventListener('click', () => aboutModal.classList.add('hidden'));

        // Load settings
        window.onload = () => {
            messageEnabled = localStorage.getItem('messageEnabled') === '1';
            showMessage('Ready.', 'gray');
            setMessageInterface();
            soundEnabled = localStorage.getItem('soundEnabled') === '1';
            setSoundInterface();
            volume = parseFloat(localStorage.getItem('volume')) || 0.5;
            volumeSlider.value = volume;

            // custom times
            const savedTimes = localStorage.getItem('customTimes');
            if (savedTimes) {
                const values = savedTimes.split(',').map(v => parseInt(v.trim())).filter(v => !isNaN(v) && v > 0);
                customTimeInputs.forEach((input, idx) => input.value = values[idx] !== undefined ? values[idx] : '');
                if (values.length > 0 && values.length <= 6) {
                    TIME_OPTIONS.length = 0;
                    values.forEach(v => TIME_OPTIONS.push(v));
                }
            } else {
                customTimeInputs.forEach((input, idx) => input.value = TIME_OPTIONS[idx] || '');
            }

            // custom pauses
            const savedPauses = localStorage.getItem('customPauses');
            if (savedPauses) {
                const values = savedPauses.split(',').map(v => parseInt(v.trim())).filter(v => !isNaN(v) && v > 0);
                customPauseInputs.forEach((input, idx) => input.value = values[idx] !== undefined ? values[idx] : '');
                PAUSE_OPTIONS = [30, 60].concat(values);
            } else {
                customPauseInputs.forEach((input, idx) => input.value = PAUSE_OPTIONS[idx] || '');
            }

            createRadioOptions();
            updateDisplay();
            startBtn.textContent = 'Start';

            cdebug('[App Init] ',{
                'messageEnabled': messageEnabled,
                'soundEnabled': soundEnabled,
                'volume':volume,
                'time options': TIME_OPTIONS,
                'pause options': PAUSE_OPTIONS,
            });
        };
    </script>
</body>

</html>