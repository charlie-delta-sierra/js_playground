<!DOCTYPE html>
<html lang="en">

<head>
    <!--
        Tailwind CSS is a utility-first CSS framework that provides low-level utility classes 
        for building custom designs directly in your HTML. Instead of writing custom CSS, 
        you compose your UI by combining Tailwind's utility classes for layout, spacing, 
        typography, colors, and more. This approach enables rapid development, consistent 
        styling, and easy maintenance of responsive and modern web interfaces.
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time helper</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <!-- <link rel="stylesheet" href="style.css"> -->
    <style>
        :root {
            --primary-black: #1f2937;
            --primary-white: #f3f4f6;
            --ring-size: 200px;
        }

        body {
            font-family: 'Inter', sans-serif;
        }

        /* .cronometer-svg {
            Remove rotation to make progress clockwise
            transform: rotate(-90deg);
        } */

        .timer-bg {
            stroke: var(--primary-white);
            stroke-width: 12;
            fill: none;
        }

        #timer-progress {
            stroke: var(--primary-black);
            stroke-width: 12;
            fill: none;
            transition: stroke-dashoffset 0.1s linear;
        }

        .center-time {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-black);
            pointer-events: none;
        }

        .label-selected {
            background-color: #8aa8d3 !important;
            /* gray-700 */
            color: #fff !important;
            font-weight: 600;
            box-shadow: 0 0 0 2px #4b5563;
            border-radius: 0.5rem;
            transition: background 0.2s, color 0.2s;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">

    <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg md:p-8 relative" style="width: fit-content;">

        <!-- Menu button -->
        <div class="absolute top-4 right-4 z-50">
            <button id="menu-btn" class="p-2 rounded-lg bg-gray-200 hover:bg-gray-300 shadow-lg">
                <svg id="menu-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" width="28" height="28">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16M4 12h16" />
                </svg>
            </button>


            <!-- Menu panel -->
            <div id="menu-panel"
                class="hidden absolute right-0 mt-2 w-64 bg-white rounded-xl shadow-xl border border-gray-200 p-4 space-y-4">

                <div class="flex space-x-4"><button id="message-btn"
                        class="w-3/4 py-3 px-3 bg-red-200 hover:bg-red-300 text-black font-semibold rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-[1.01] focus:outline-none text-sm md:text-base">
                        <!-- see main.js setMessageInterface() -->
                    </button>
                    <button id="sound-btn"
                        class="w-1/4 py-3 px-3 bg-red-200 hover:bg-red-300 rounded-full shadow-md transition duration-150 ease-in-out focus:outline-none text-sm md:text-base">
                        <svg id="sound-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor" width="24" height="24">
                            <!-- see main.js setSoundInterface() -->
                        </svg></button>
                </div>
                <div>
                    <label for="volume-slider" class="block text-gray-700 font-semibold mb-2">Volume</label>
                    <input id="volume-slider" type="range" min="0" max="1" step="0.01" value="0.5" class="w-full">
                </div>

                <!-- time options -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Time options</label>
                    <div id="custom-times-grid" class="grid grid-cols-3 gap-2 mb-2">
                        <input type="text" maxlength="2"
                            class="custom-time-input p-2 border bg-gray-200 rounded-lg text-center" />
                        <input type="text" maxlength="2"
                            class="custom-time-input p-2 border bg-gray-200 rounded-lg text-center" />
                        <input type="text" maxlength="2"
                            class="custom-time-input p-2 border bg-gray-200 rounded-lg text-center" />
                        <input type="text" maxlength="2"
                            class="custom-time-input p-2 border bg-gray-200 rounded-lg text-center" />
                        <input type="text" maxlength="2"
                            class="custom-time-input p-2 border bg-gray-200 rounded-lg text-center" />
                        <input type="text" maxlength="2"
                            class="custom-time-input p-2 border bg-gray-200 rounded-lg text-center" />
                    </div>
                    <!-- <div class="text-xs text-gray-500 mb-2">Enter up to 6 positive numbers (minutes).</div> -->
                </div>

                <div>
                    <button id="about-btn" class="max-w-full text-center text-sm text-gray-600"
                        style="width: -webkit-fill-available;">About</button>
                </div>


            </div>
        </div>

        <!-- App panel -->
        <div class="md:flex md:space-x-8 items-center justify-center w-full mt-4">

            <div class="flex-shrink-0 relative flex items-center justify-center mb-8 md:mb-0"
                style="height: var(--ring-size);">
                <svg class="cronometer-svg" width="100%" height="100%" viewBox="0 0 200 200">
                    <circle class="timer-bg" cx="100" cy="100" r="90"></circle>
                    <circle id="timer-progress" cx="100" cy="100" r="90" transform="rotate(-90 100 100)"></circle>
                </svg>
                <div id="time-display" class="center-time">01:00</div>
            </div>

            <div class="flex-grow w-full max-w-xs mx-auto md:mx-0">
                <div id="time-options" class="grid grid-cols-3 gap-3 mb-6 mt-12"></div>
                <div class="flex space-x-4">
                    <button id="start-btn"
                        class="flex-1 py-3 px-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-green-500/50 text-sm md:text-base">Start</button>
                    <button id="reset-btn"
                        class="flex-1 py-3 px-3 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-lg shadow-md transition duration-150 ease-in-out focus:outline-none focus:ring-4 focus:ring-blue-500/50 text-sm md:text-base">Reset</button>
                </div>
                <div id="message-box"
                    class="mt-4 p-3 bg-blue-100 border border-blue-300 text-blue-700 rounded-lg hidden text-sm"></div>
            </div>

        </div>
    </div>

    <!-- About modal -->
    <div id="about-modal" class="hidden fixed inset-0 bg-black-40 flex items-center justify-center"
        style="z-index: 51;">

        <div class="flex flex-col items-center">
            <div id="about-content" class="bg-white p-6 rounded-lg max-w-sm">
                <!-- <h2 class="text-lg font-semibold">About</h2> -->
                <h3 class="text-lg font-semibold mt-4">App</h3>
                <p class="mt-2 text-sm">The Time helper is a minimalist application designed using only ES6 and
                    tailwindcss to manage short time intervals. </p>
                <p class="mt-2 text-sm">The motivations were to provide
                    a distraction-free tool for:</p>
                <ul class="list-disc list-outside pl-4 text-sm mt-2">
                    <li class="mt-2 text-sm">to manage home <strong>workout</strong> intervals; and,</li>
                    <li class="mt-2 text-sm">to monitor strategy game <strong>cooldowns</strong> like SimCity BuildIt
                    </li>
                </ul>
                <p class="mt-2 text-sm">It is intentionally
                    light-weight, scalable, and fully customizable.</p>

                <div class="mt-4 pt-3 border-t border-gray-200 text-sm">
                    <h3 class="text-lg font-semibold mt-4">Author</h3>
                    <p class="mt-2 text-sm">This application was developed by a passionate technologist focused on
                        creating
                        practical solutions that <strong>bridge</strong> personal interests with professional skills.
                    </p>
                    <p class="mt-2 text-gray-600">October 17th, 2025</p>
                    <p class="font-semibold">Cicero Lima</p>
                </div>
            </div>
            <button id="close-about-modal-btn"
                class="mt-4 w-10 h-10 border-black bg-white text-gray-800 rounded-full shadow-lg flex items-center justify-center 
                   hover:bg-gray-200 focus:outline-none focus:ring-4 focus:ring-gray-300 transition duration-150 ease-in-out">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>

        </div>
    </div>

    <!-- <script src="main.js"></script>
    <script src="about.js"></script> -->
    <script>
        const TIME_OPTIONS = [1, 3, 5, 10, 15, 30];
        const CIRCLE_RADIUS = 90;
        const CIRCUMFERENCE = 2 * Math.PI * CIRCLE_RADIUS;

        const timeDisplay = document.getElementById('time-display');
        const timerProgress = document.getElementById('timer-progress');
        const timeOptionsContainer = document.getElementById('time-options');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');
        const messageBox = document.getElementById('message-box');

        let totalTimeSeconds = TIME_OPTIONS[0] * 60;
        let timeLeftSeconds = totalTimeSeconds;
        let isRunning = false;
        let timerInterval = null;
        let volume = 0.5;
        let soundEnabled = false;
        let messageEnabled = false;

        const menuBtn = document.getElementById('menu-btn');
        const menuPanel = document.getElementById('menu-panel');
        const messageBtn = document.getElementById('message-btn');
        const soundBtn = document.getElementById('sound-btn');
        const soundIcon = document.getElementById('sound-icon');
        const volumeSlider = document.getElementById('volume-slider');
        const customTimesGrid = document.getElementById('custom-times-grid');
        const customTimeInputs = customTimesGrid.querySelectorAll('.custom-time-input');

        timerProgress.style.strokeDasharray = CIRCUMFERENCE;
        timerProgress.style.strokeDashoffset = 0;

        const formatTime = (seconds) => {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            const pad = (n) => String(n).padStart(2, '0');
            return `${pad(minutes)}:${pad(remainingSeconds)}`;
        };

        const updateProgress = () => {
            const percentage = timeLeftSeconds / totalTimeSeconds;
            // -- For counter-clockwise, offset increases as time passes
            const offset = CIRCUMFERENCE * (1 - percentage);
            // -- For clockwise rotation. it inverts the foreground, background colors
            // const offset = CIRCUMFERENCE * percentage;
            timerProgress.style.strokeDashoffset = offset;
        };

        const updateDisplay = () => {
            timeDisplay.textContent = formatTime(timeLeftSeconds);
            updateProgress();
        };

        const showMessage = (text, type = 'blue') => {
            if (!messageEnabled) return;
            messageBox.textContent = text;
            messageBox.className = `mt-4 p-3 border rounded-lg text-sm`;
            if (type === 'blue') {
                messageBox.classList.add('bg-blue-100', 'border-blue-300', 'text-blue-700');
            } else if (type === 'green') {
                messageBox.classList.add('bg-green-100', 'border-green-300', 'text-green-700');
            }
            messageBox.classList.remove('hidden');
            setTimeout(() => {
                if (messageEnabled) messageBox.classList.add('hidden');
            }, 3000);
        };

        function beep() {
            if (!soundEnabled) return;
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = ctx.createOscillator();
            const gain = ctx.createGain();
            oscillator.type = 'sine';
            oscillator.frequency.value = 880;
            gain.gain.value = volume;
            oscillator.connect(gain);
            gain.connect(ctx.destination);
            oscillator.start();
            setTimeout(() => {
                oscillator.stop();
                ctx.close();
            }, 200);
        }

        const countdown = () => {
            if (!isRunning) return;
            timeLeftSeconds--;
            updateDisplay();
            if (timeLeftSeconds <= 0) {
                clearInterval(timerInterval);
                isRunning = false;
                startBtn.textContent = 'Start';
                startBtn.classList.remove('bg-yellow-600', 'hover:bg-yellow-700');
                startBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                showMessage('Time is up! Countdown finished.', 'green');
            }
        };

        const handleStartStop = () => {
            console.log(`run button clicked`)
            if (isRunning) {
                clearInterval(timerInterval);
                isRunning = false;
                startBtn.textContent = 'Start';
                startBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
                startBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                showMessage("Timer stopped.", 'blue');
            } else {
                isRunning = true;
                startBtn.textContent = 'Stop';
                startBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                startBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                timerInterval = setInterval(() => {
                    timeLeftSeconds--;
                    if (timeLeftSeconds <= 0) {
                        timeLeftSeconds = totalTimeSeconds;
                        beep();
                        showMessage('Time is up! Restarting countdown.', 'green');
                    }
                    updateDisplay();
                }, 1000);
            }
        };

        const handleReset = () => {
            clearInterval(timerInterval);
            isRunning = false;
            const selectedRadio = document.querySelector('input[name="time-preset"]:checked');
            const minutes = selectedRadio ? parseInt(selectedRadio.value) : TIME_OPTIONS[0];
            totalTimeSeconds = minutes * 60;
            timeLeftSeconds = totalTimeSeconds;
            updateDisplay();
            startBtn.textContent = 'Start';
            startBtn.classList.remove('bg-yellow-600', 'hover:bg-yellow-700');
            startBtn.classList.add('bg-green-600', 'hover:bg-green-700');
            showMessage("Timer reset to " + formatTime(totalTimeSeconds) + ".", 'blue');
        };

        const createRadioOptions = () => {
            TIME_OPTIONS.forEach((minutes, index) => {
                const isChecked = index === 0;
                const label = document.createElement('label');
                label.className = "flex items-center justify-center p-2 rounded-lg cursor-pointer transition duration-150 ease-in-out shadow-inner bg-gray-50 hover:bg-gray-200 text-sm font-medium text-gray-700";
                if (isChecked) label.classList.add('label-selected');
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = 'time-preset';
                input.value = minutes;
                input.className = 'hidden';
                input.checked = isChecked;
                const span = document.createElement('span');
                span.textContent = `${minutes} min`;
                input.addEventListener('change', handleTimeChange);
                label.appendChild(input);
                label.appendChild(span);
                timeOptionsContainer.appendChild(label);
            });
        };

        const handleTimeChange = (event) => {
            if (isRunning) {
                showMessage("Please pause or reset the timer before changing the duration.", 'blue');
                document.querySelectorAll('#time-options label').forEach(label => {
                    label.classList.remove('label-selected');
                });
                const checkedRadio = document.querySelector('input[name="time-preset"]:checked');
                if (checkedRadio) checkedRadio.parentElement.classList.add('label-selected');
                return;
            }
            const newMinutes = parseInt(event.target.value);
            totalTimeSeconds = newMinutes * 60;
            timeLeftSeconds = totalTimeSeconds;
            updateDisplay();
            document.querySelectorAll('#time-options label').forEach(label => {
                label.classList.remove('label-selected');
            });
            event.target.parentElement.classList.add('label-selected');
        };

        menuBtn.addEventListener('click', () => {
            menuPanel.classList.toggle('hidden');
        });

        document.addEventListener('mousedown', (e) => {
            if (!menuBtn.contains(e.target) && !menuPanel.contains(e.target)) {
                menuPanel.classList.add('hidden');
            }
        });

        const setSoundInterface = () => {
            soundIcon.innerHTML = soundEnabled
                ? `<path d="M9 9v6h4l5 5V4l-5 5H9z" />`
                : `<path d="M9 9v6h4l5 5V4l-5 5H9z"/><line x1="20" y1="4" x2="4" y2="20" stroke="red" stroke-width="2"/>`;
        };

        const setMessageInterface = () => {
            messageBtn.innerHTML = messageEnabled
                ? `<span>Messages</span>`
                : `<span>Messages</span><span id="messages-line" class="absolute top-1/2 left-1/2 w-1/4 h-1 bg-red-500 transform -rotate-45 origin-center -translate-y-1/2 -translate-x-1/2"></span>`;
        };

        soundBtn.addEventListener('click', () => {
            soundEnabled = !soundEnabled;
            localStorage.setItem('soundEnabled', soundEnabled ? '1' : '0');
            setSoundInterface();
            if (soundEnabled) {
                soundBtn.classList.remove('bg-red-200', 'hover:bg-red-300');
                soundBtn.classList.add('bg-blue-200', 'hover:bg-blue-300');
            } else {
                soundBtn.classList.add('bg-red-200', 'hover:bg-red-300');
                soundBtn.classList.remove('bg-blue-200', 'hover:bg-blue-300');
            }
        });

        messageBtn.addEventListener('click', (e) => {
            messageEnabled = !messageEnabled;
            localStorage.setItem('messageEnabled', messageEnabled ? '1' : '0');
            setMessageInterface();
            if (messageEnabled) {
                messageBtn.classList.remove('bg-red-200', 'hover:bg-red-300');
                messageBtn.classList.add('bg-blue-200', 'hover:bg-blue-300');
                messageBox.classList.remove('hidden');
            } else {
                messageBtn.classList.add('bg-red-200', 'hover:bg-red-300');
                messageBtn.classList.remove('bg-blue-200', 'hover:bg-blue-300');
                messageBox.classList.add('hidden');
            }
        });

        volumeSlider.addEventListener('input', (e) => {
            volume = parseFloat(e.target.value);
            localStorage.setItem('volume', volume);
        });

        customTimeInputs.forEach(input => {
            input.addEventListener('input', (e) => {
                e.target.value = e.target.value.replace(/[^0-9]/g, '');
            });
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.target.blur();
                    menuPanel.classList.add('hidden');
                }
            });
        });

        function saveCustomTimes() {
            const values = Array.from(customTimeInputs)
                .map(input => input.value.trim())
                .filter(v => v !== '')
                .map(v => parseInt(v, 10))
                .filter(v => !isNaN(v) && v > 0);

            if (values.length === 0 || values.length > 6) {
                showMessage('Please enter up to 6 positive numbers.', 'blue');
                return;
            }
            TIME_OPTIONS.length = 0;
            values.forEach(v => TIME_OPTIONS.push(v));
            localStorage.setItem('customTimes', values.join(','));
            handleReset();
            timeOptionsContainer.innerHTML = '';
            createRadioOptions();
        }

        customTimeInputs.forEach(input => {
            input.addEventListener('blur', saveCustomTimes);
        });

        startBtn.addEventListener('click', handleStartStop);
        resetBtn.addEventListener('click', handleReset);

        const aboutBtn = document.getElementById('about-btn');

        const aboutModal = document.getElementById('about-modal');
        const aboutContent = document.getElementById('about-content');

        aboutBtn.addEventListener('click', () => {
            aboutModal.classList.remove('hidden');
            document.getElementById("menu-panel").classList.add('hidden');
        });

        aboutModal.addEventListener('mousedown', (e) => {
            if (!aboutContent.contains(e.target)) {
                aboutModal.classList.add('hidden');
            }
        });


        // Load settings from localStorage
        window.onload = () => {
            // Messages
            messageEnabled = localStorage.getItem('messageEnabled') === '1';
            setMessageInterface();

            // Sound
            soundEnabled = localStorage.getItem('soundEnabled') === '1';
            setSoundInterface();

            // Volume
            volume = parseFloat(localStorage.getItem('volume')) || 0.5;
            volumeSlider.value = volume;

            // Custom times
            const savedTimes = localStorage.getItem('customTimes');
            if (savedTimes) {
                const values = savedTimes.split(',').map(v => parseInt(v.trim())).filter(v => !isNaN(v) && v > 0);
                customTimeInputs.forEach((input, idx) => {
                    input.value = values[idx] !== undefined ? values[idx] : '';
                    console.log(`input values: ${input.value}`)
                });
                if (values.length > 0 && values.length <= 6) {
                    TIME_OPTIONS.length = 0;
                    values.forEach(v => TIME_OPTIONS.push(v));
                }
            } else {
                customTimeInputs.forEach((input, idx) => {
                    input.value = TIME_OPTIONS[idx] || '';
                });
            }
            createRadioOptions();
            updateDisplay();
            startBtn.textContent = 'Start';
        };
    </script>
</body>

</html>